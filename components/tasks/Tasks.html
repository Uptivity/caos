<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks - CAOS CRM</title>
    <link rel="stylesheet" href="../../styles/snowui.css">
    <style>
        /* Tasks Component - Built on SnowUI Design System */

        /* Layout Structure */
        .tasks-container {
            min-height: 100vh;
            background: var(--snow-gray-50);
        }

        .tasks-header {
            background: var(--snow-white);
            border-bottom: 1px solid var(--snow-gray-200);
            padding: var(--space-4) var(--space-6);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .header-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--snow-gray-900);
            margin: 0;
        }

        .header-subtitle {
            font-size: var(--text-sm);
            color: var(--snow-gray-600);
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .view-switcher {
            display: flex;
            background: var(--snow-gray-100);
            border-radius: var(--radius-md);
            padding: var(--space-1);
        }

        .view-switcher button {
            padding: var(--space-2) var(--space-3);
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            color: var(--snow-gray-600);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .view-switcher button.active {
            background: var(--snow-white);
            color: var(--snow-gray-900);
            box-shadow: var(--shadow-sm);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-6);
        }

        /* Filters and Controls */
        .controls-section {
            background: var(--snow-white);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            border: 1px solid var(--snow-gray-200);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-3);
            align-items: end;
            margin-bottom: var(--space-4);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .control-label {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--snow-gray-700);
        }

        .quick-actions {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        /* Task Statistics */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .stat-card {
            background: var(--snow-white);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            border: 1px solid var(--snow-gray-200);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.todo::before { background: var(--snow-blue-500); }
        .stat-card.progress::before { background: var(--snow-orange-500); }
        .stat-card.completed::before { background: var(--snow-green-500); }
        .stat-card.overdue::before { background: var(--snow-red-500); }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-2);
        }

        .stat-title {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--snow-gray-600);
        }

        .stat-icon {
            width: 16px;
            height: 16px;
            color: var(--snow-gray-400);
        }

        .stat-value {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--snow-gray-900);
            line-height: 1;
        }

        /* Task Views */
        .view-container {
            background: var(--snow-white);
            border-radius: var(--radius-lg);
            border: 1px solid var(--snow-gray-200);
            overflow: hidden;
        }

        .view-content {
            min-height: 400px;
        }

        /* List View */
        .list-view {
            display: block;
        }

        .list-view.hidden {
            display: none;
        }

        .task-list {
            divide-y divide-gray-200;
        }

        .task-item {
            padding: var(--space-4);
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--snow-gray-100);
        }

        .task-item:hover {
            background: var(--snow-gray-50);
        }

        .task-item.selected {
            background: var(--snow-blue-50);
            border-left: 4px solid var(--snow-blue-500);
        }

        .task-content {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }

        .task-checkbox {
            margin-top: var(--space-1);
        }

        .task-details {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--snow-gray-900);
            margin-bottom: var(--space-1);
            line-height: 1.4;
        }

        .task-title.completed {
            text-decoration: line-through;
            color: var(--snow-gray-500);
        }

        .task-description {
            font-size: var(--text-sm);
            color: var(--snow-gray-600);
            margin-bottom: var(--space-2);
            line-height: 1.4;
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex-wrap: wrap;
        }

        .task-priority {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        .task-priority.urgent {
            background: var(--snow-red-100);
            color: var(--snow-red-700);
        }

        .task-priority.high {
            background: var(--snow-orange-100);
            color: var(--snow-orange-700);
        }

        .task-priority.medium {
            background: var(--snow-blue-100);
            color: var(--snow-blue-700);
        }

        .task-priority.low {
            background: var(--snow-gray-100);
            color: var(--snow-gray-700);
        }

        .task-status {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        .task-status.todo {
            background: var(--snow-blue-100);
            color: var(--snow-blue-700);
        }

        .task-status.in_progress {
            background: var(--snow-orange-100);
            color: var(--snow-orange-700);
        }

        .task-status.review {
            background: var(--snow-purple-100);
            color: var(--snow-purple-700);
        }

        .task-status.completed {
            background: var(--snow-green-100);
            color: var(--snow-green-700);
        }

        .task-status.blocked {
            background: var(--snow-red-100);
            color: var(--snow-red-700);
        }

        .task-due-date {
            font-size: var(--text-xs);
            color: var(--snow-gray-500);
        }

        .task-due-date.overdue {
            color: var(--snow-red-600);
            font-weight: 600;
        }

        .task-tags {
            display: flex;
            gap: var(--space-1);
            flex-wrap: wrap;
        }

        .task-tag {
            padding: var(--space-1) var(--space-2);
            background: var(--snow-gray-100);
            color: var(--snow-gray-700);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        .task-actions {
            display: flex;
            gap: var(--space-2);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .task-item:hover .task-actions {
            opacity: 1;
        }

        /* Kanban View */
        .kanban-view {
            display: none;
            padding: var(--space-4);
        }

        .kanban-view.active {
            display: block;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-4);
            min-height: 500px;
        }

        .kanban-column {
            background: var(--snow-gray-50);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            border: 1px solid var(--snow-gray-200);
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-2) var(--space-3);
            background: var(--snow-white);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-3);
            border-left: 4px solid;
        }

        .column-header.todo { border-left-color: var(--snow-blue-500); }
        .column-header.in_progress { border-left-color: var(--snow-orange-500); }
        .column-header.review { border-left-color: var(--snow-purple-500); }
        .column-header.completed { border-left-color: var(--snow-green-500); }

        .column-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--snow-gray-900);
        }

        .column-count {
            background: var(--snow-gray-100);
            color: var(--snow-gray-600);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 600;
        }

        .kanban-tasks {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            min-height: 200px;
        }

        .kanban-task {
            background: var(--snow-white);
            border-radius: var(--radius-sm);
            padding: var(--space-3);
            border: 1px solid var(--snow-gray-200);
            cursor: grab;
            transition: all 0.2s ease;
        }

        .kanban-task:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .kanban-task.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        /* Calendar View */
        .calendar-view {
            display: none;
            padding: var(--space-4);
        }

        .calendar-view.active {
            display: block;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .calendar-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--snow-gray-900);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--snow-gray-200);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--snow-gray-100);
            padding: var(--space-2);
            text-align: center;
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--snow-gray-700);
        }

        .calendar-day {
            background: var(--snow-white);
            min-height: 100px;
            padding: var(--space-2);
            position: relative;
        }

        .calendar-day.today {
            background: var(--snow-blue-50);
        }

        .calendar-day.other-month {
            background: var(--snow-gray-50);
            color: var(--snow-gray-400);
        }

        .day-number {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--snow-gray-900);
            margin-bottom: var(--space-1);
        }

        .day-tasks {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .calendar-task {
            font-size: var(--text-xs);
            padding: var(--space-1);
            border-radius: var(--radius-sm);
            background: var(--snow-blue-100);
            color: var(--snow-blue-700);
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Task Detail Modal */
        .task-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .task-modal.active {
            display: flex;
        }

        .task-modal-content {
            background: var(--snow-white);
            border-radius: var(--radius-lg);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-6);
            border-bottom: 1px solid var(--snow-gray-200);
        }

        .modal-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--snow-gray-900);
        }

        .modal-body {
            padding: var(--space-6);
        }

        .modal-actions {
            display: flex;
            gap: var(--space-3);
            justify-content: flex-end;
            padding: var(--space-4) var(--space-6);
            border-top: 1px solid var(--snow-gray-200);
        }

        /* Task Form */
        .task-form {
            display: grid;
            gap: var(--space-4);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-4);
        }

        .textarea-field {
            min-height: 80px;
            resize: vertical;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: var(--space-12);
            color: var(--snow-gray-500);
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto var(--space-4);
            color: var(--snow-gray-300);
        }

        .empty-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--snow-gray-700);
            margin-bottom: var(--space-2);
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-8);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--snow-gray-200);
            border-top-color: var(--snow-blue-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: var(--space-3);
                align-items: stretch;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .kanban-board {
                grid-template-columns: 1fr;
                overflow-x: auto;
                white-space: nowrap;
            }

            .kanban-board > * {
                white-space: normal;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Drag and Drop */
        .drop-zone {
            border: 2px dashed var(--snow-blue-300);
            background: var(--snow-blue-50);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            text-align: center;
            color: var(--snow-blue-600);
            margin: var(--space-2) 0;
        }

        .drag-over {
            border-color: var(--snow-blue-500);
            background: var(--snow-blue-100);
        }
    </style>
</head>
<body>
    <div class="tasks-container">
        <!-- Header -->
        <header class="tasks-header">
            <div class="header-content">
                <div class="header-left">
                    <div>
                        <h1 class="header-title">Tasks</h1>
                        <p class="header-subtitle">Manage and track your tasks and projects</p>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="view-switcher">
                        <button id="listViewBtn" class="active">List</button>
                        <button id="kanbanViewBtn">Kanban</button>
                        <button id="calendarViewBtn">Calendar</button>
                    </div>
                    <button class="btn btn-primary" onclick="openTaskModal()">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        New Task
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Controls Section -->
            <section class="controls-section">
                <div class="controls-grid">
                    <div class="control-group">
                        <label class="control-label">Status</label>
                        <select id="statusFilter" class="select">
                            <option value="">All Status</option>
                            <option value="todo">To Do</option>
                            <option value="in_progress">In Progress</option>
                            <option value="review">Review</option>
                            <option value="completed">Completed</option>
                            <option value="blocked">Blocked</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Priority</label>
                        <select id="priorityFilter" class="select">
                            <option value="">All Priorities</option>
                            <option value="urgent">Urgent</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Category</label>
                        <select id="categoryFilter" class="select">
                            <option value="">All Categories</option>
                            <option value="sales">Sales</option>
                            <option value="marketing">Marketing</option>
                            <option value="support">Support</option>
                            <option value="admin">Admin</option>
                            <option value="project">Project</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Search</label>
                        <input type="text" id="searchInput" class="input" placeholder="Search tasks...">
                    </div>
                </div>
                <div class="quick-actions">
                    <button class="btn btn-sm btn-outline" onclick="clearFilters()">Clear Filters</button>
                    <button class="btn btn-sm btn-outline" onclick="refreshTasks()">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Refresh
                    </button>
                    <button class="btn btn-sm btn-outline" onclick="showMyTasks()">My Tasks</button>
                </div>
            </section>

            <!-- Statistics Section -->
            <section class="stats-section" id="statsSection">
                <div class="stat-card todo">
                    <div class="stat-header">
                        <span class="stat-title">To Do</span>
                        <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                    </div>
                    <div class="stat-value" id="todoCount">-</div>
                </div>

                <div class="stat-card progress">
                    <div class="stat-header">
                        <span class="stat-title">In Progress</span>
                        <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div class="stat-value" id="progressCount">-</div>
                </div>

                <div class="stat-card completed">
                    <div class="stat-header">
                        <span class="stat-title">Completed</span>
                        <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="stat-value" id="completedCount">-</div>
                </div>

                <div class="stat-card overdue">
                    <div class="stat-header">
                        <span class="stat-title">Overdue</span>
                        <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="stat-value" id="overdueCount">-</div>
                </div>
            </section>

            <!-- Task Views -->
            <section class="view-container">
                <!-- List View -->
                <div id="listView" class="list-view view-content">
                    <div id="tasksList" class="task-list">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="kanbanView" class="kanban-view view-content">
                    <div class="kanban-board">
                        <div class="kanban-column">
                            <div class="column-header todo">
                                <span class="column-title">To Do</span>
                                <span class="column-count" id="todoColumnCount">0</span>
                            </div>
                            <div class="kanban-tasks" id="todoColumn" data-status="todo">
                                <!-- Tasks will be populated here -->
                            </div>
                        </div>

                        <div class="kanban-column">
                            <div class="column-header in_progress">
                                <span class="column-title">In Progress</span>
                                <span class="column-count" id="progressColumnCount">0</span>
                            </div>
                            <div class="kanban-tasks" id="progressColumn" data-status="in_progress">
                                <!-- Tasks will be populated here -->
                            </div>
                        </div>

                        <div class="kanban-column">
                            <div class="column-header review">
                                <span class="column-title">Review</span>
                                <span class="column-count" id="reviewColumnCount">0</span>
                            </div>
                            <div class="kanban-tasks" id="reviewColumn" data-status="review">
                                <!-- Tasks will be populated here -->
                            </div>
                        </div>

                        <div class="kanban-column">
                            <div class="column-header completed">
                                <span class="column-title">Completed</span>
                                <span class="column-count" id="completedColumnCount">0</span>
                            </div>
                            <div class="kanban-tasks" id="completedColumn" data-status="completed">
                                <!-- Tasks will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="calendarView" class="calendar-view view-content">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="btn btn-sm btn-outline" onclick="previousMonth()">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <h3 class="calendar-title" id="calendarTitle">December 2024</h3>
                            <button class="btn btn-sm btn-outline" onclick="nextMonth()">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="goToToday()">Today</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be generated here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Task Modal -->
    <div class="task-modal" id="taskModal">
        <div class="task-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">New Task</h3>
                <button class="btn btn-text" onclick="closeTaskModal()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form class="task-form" id="taskForm">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" id="taskTitle" class="input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="taskDescription" class="input textarea-field" placeholder="Task description..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Priority</label>
                            <select id="taskPriority" class="select">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select id="taskStatus" class="select">
                                <option value="todo" selected>To Do</option>
                                <option value="in_progress">In Progress</option>
                                <option value="review">Review</option>
                                <option value="blocked">Blocked</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select id="taskCategory" class="select">
                                <option value="admin">Admin</option>
                                <option value="sales">Sales</option>
                                <option value="marketing">Marketing</option>
                                <option value="support">Support</option>
                                <option value="project">Project</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <select id="taskType" class="select">
                                <option value="general">General</option>
                                <option value="lead_follow_up">Lead Follow-up</option>
                                <option value="campaign">Campaign</option>
                                <option value="meeting">Meeting</option>
                                <option value="call">Call</option>
                                <option value="email">Email</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Due Date</label>
                            <input type="datetime-local" id="taskDueDate" class="input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Estimated Hours</label>
                            <input type="number" id="taskEstimatedHours" class="input" min="0" step="0.5">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tags</label>
                        <input type="text" id="taskTags" class="input" placeholder="Enter tags separated by commas">
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeTaskModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTask()">Save Task</button>
            </div>
        </div>
    </div>

    <script>
        // Tasks Application State
        const TasksApp = {
            currentView: 'list',
            tasks: [],
            filteredTasks: [],
            filters: {
                status: '',
                priority: '',
                category: '',
                search: ''
            },
            currentTask: null,
            currentDate: new Date(),

            async init() {
                this.setupEventListeners();
                await this.loadTasks();
                await this.loadStats();
                this.renderCurrentView();
            },

            setupEventListeners() {
                // View switcher
                document.getElementById('listViewBtn').addEventListener('click', () => this.switchView('list'));
                document.getElementById('kanbanViewBtn').addEventListener('click', () => this.switchView('kanban'));
                document.getElementById('calendarViewBtn').addEventListener('click', () => this.switchView('calendar'));

                // Filters
                document.getElementById('statusFilter').addEventListener('change', (e) => {
                    this.filters.status = e.target.value;
                    this.applyFilters();
                });

                document.getElementById('priorityFilter').addEventListener('change', (e) => {
                    this.filters.priority = e.target.value;
                    this.applyFilters();
                });

                document.getElementById('categoryFilter').addEventListener('change', (e) => {
                    this.filters.category = e.target.value;
                    this.applyFilters();
                });

                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.filters.search = e.target.value;
                    this.applyFilters();
                });

                // Task form submission
                document.getElementById('taskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveTask();
                });
            },

            async loadTasks() {
                try {
                    const response = await fetch('/api/tasks', {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    this.tasks = result.data;
                    this.filteredTasks = [...this.tasks];
                    this.renderCurrentView();
                } catch (error) {
                    console.error('Failed to load tasks:', error);
                    this.showError('Failed to load tasks');
                }
            },

            async loadStats() {
                try {
                    const response = await fetch('/api/tasks/stats', {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    this.updateStats(result.data);
                } catch (error) {
                    console.error('Failed to load stats:', error);
                }
            },

            updateStats(stats) {
                document.getElementById('todoCount').textContent = stats.byStatus.todo || 0;
                document.getElementById('progressCount').textContent = stats.byStatus.in_progress || 0;
                document.getElementById('completedCount').textContent = stats.byStatus.completed || 0;
                document.getElementById('overdueCount').textContent = stats.overdue || 0;
            },

            applyFilters() {
                this.filteredTasks = this.tasks.filter(task => {
                    if (this.filters.status && task.status !== this.filters.status) return false;
                    if (this.filters.priority && task.priority !== this.filters.priority) return false;
                    if (this.filters.category && task.category !== this.filters.category) return false;
                    if (this.filters.search) {
                        const searchTerm = this.filters.search.toLowerCase();
                        if (!task.title.toLowerCase().includes(searchTerm) &&
                            !task.description.toLowerCase().includes(searchTerm)) return false;
                    }
                    return true;
                });

                this.renderCurrentView();
            },

            switchView(view) {
                this.currentView = view;

                // Update view switcher buttons
                document.querySelectorAll('.view-switcher button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`${view}ViewBtn`).classList.add('active');

                // Show/hide views
                document.getElementById('listView').classList.toggle('hidden', view !== 'list');
                document.getElementById('kanbanView').classList.toggle('active', view === 'kanban');
                document.getElementById('calendarView').classList.toggle('active', view === 'calendar');

                this.renderCurrentView();
            },

            renderCurrentView() {
                switch (this.currentView) {
                    case 'list':
                        this.renderListView();
                        break;
                    case 'kanban':
                        this.renderKanbanView();
                        break;
                    case 'calendar':
                        this.renderCalendarView();
                        break;
                }
            },

            renderListView() {
                const container = document.getElementById('tasksList');

                if (this.filteredTasks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            <h3 class="empty-title">No tasks found</h3>
                            <p>Create your first task or adjust your filters.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredTasks.map(task => `
                    <div class="task-item" data-task-id="${task.id}" onclick="openTaskModal('${task.id}')">
                        <div class="task-content">
                            <input type="checkbox" class="task-checkbox" ${task.status === 'completed' ? 'checked' : ''}
                                   onchange="toggleTaskStatus('${task.id}')" onclick="event.stopPropagation()">
                            <div class="task-details">
                                <h4 class="task-title ${task.status === 'completed' ? 'completed' : ''}">${task.title}</h4>
                                ${task.description ? `<p class="task-description">${task.description}</p>` : ''}
                                <div class="task-meta">
                                    <span class="task-priority ${task.priority}">${this.formatPriority(task.priority)}</span>
                                    <span class="task-status ${task.status}">${this.formatStatus(task.status)}</span>
                                    ${task.dueDate ? `<span class="task-due-date ${this.isOverdue(task.dueDate) ? 'overdue' : ''}">${this.formatDate(task.dueDate)}</span>` : ''}
                                    ${task.tags.length > 0 ? `
                                        <div class="task-tags">
                                            ${task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="btn btn-sm btn-outline" onclick="editTask('${task.id}')" title="Edit">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="deleteTask('${task.id}')" title="Delete">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            renderKanbanView() {
                const statuses = ['todo', 'in_progress', 'review', 'completed'];

                statuses.forEach(status => {
                    const column = document.getElementById(`${status === 'in_progress' ? 'progress' : status}Column`);
                    const tasks = this.filteredTasks.filter(task => task.status === status);

                    // Update column count
                    const countElement = document.getElementById(`${status === 'in_progress' ? 'progress' : status}ColumnCount`);
                    if (countElement) {
                        countElement.textContent = tasks.length;
                    }

                    column.innerHTML = tasks.map(task => `
                        <div class="kanban-task" data-task-id="${task.id}" draggable="true">
                            <div class="task-title">${task.title}</div>
                            ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                            <div class="task-meta">
                                <span class="task-priority ${task.priority}">${this.formatPriority(task.priority)}</span>
                                ${task.dueDate ? `<span class="task-due-date ${this.isOverdue(task.dueDate) ? 'overdue' : ''}">${this.formatDate(task.dueDate)}</span>` : ''}
                            </div>
                        </div>
                    `).join('');
                });

                this.setupDragAndDrop();
            },

            renderCalendarView() {
                const calendar = document.getElementById('calendarGrid');
                const title = document.getElementById('calendarTitle');

                // Update calendar title
                title.textContent = this.currentDate.toLocaleDateString('en-US', {
                    month: 'long',
                    year: 'numeric'
                });

                // Generate calendar grid
                const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                const lastDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                let calendarHtml = `
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                `;

                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);

                    const isToday = date.toDateString() === new Date().toDateString();
                    const isCurrentMonth = date.getMonth() === this.currentDate.getMonth();

                    // Get tasks for this date
                    const dayTasks = this.filteredTasks.filter(task => {
                        if (!task.dueDate) return false;
                        const taskDate = new Date(task.dueDate);
                        return taskDate.toDateString() === date.toDateString();
                    });

                    calendarHtml += `
                        <div class="calendar-day ${isToday ? 'today' : ''} ${!isCurrentMonth ? 'other-month' : ''}">
                            <div class="day-number">${date.getDate()}</div>
                            <div class="day-tasks">
                                ${dayTasks.slice(0, 3).map(task => `
                                    <div class="calendar-task" onclick="openTaskModal('${task.id}')" title="${task.title}">
                                        ${task.title}
                                    </div>
                                `).join('')}
                                ${dayTasks.length > 3 ? `<div class="calendar-task">+${dayTasks.length - 3} more</div>` : ''}
                            </div>
                        </div>
                    `;
                }

                calendar.innerHTML = calendarHtml;
            },

            setupDragAndDrop() {
                const tasks = document.querySelectorAll('.kanban-task');
                const columns = document.querySelectorAll('.kanban-tasks');

                tasks.forEach(task => {
                    task.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', task.dataset.taskId);
                        task.classList.add('dragging');
                    });

                    task.addEventListener('dragend', () => {
                        task.classList.remove('dragging');
                    });
                });

                columns.forEach(column => {
                    column.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        column.classList.add('drag-over');
                    });

                    column.addEventListener('dragleave', () => {
                        column.classList.remove('drag-over');
                    });

                    column.addEventListener('drop', async (e) => {
                        e.preventDefault();
                        column.classList.remove('drag-over');

                        const taskId = e.dataTransfer.getData('text/plain');
                        const newStatus = column.dataset.status;

                        await this.updateTaskStatus(taskId, newStatus);
                    });
                });
            },

            async updateTaskStatus(taskId, status) {
                try {
                    const response = await fetch(`/api/tasks/${taskId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    await this.loadTasks();
                    await this.loadStats();
                } catch (error) {
                    console.error('Failed to update task status:', error);
                    this.showError('Failed to update task status');
                }
            },

            async saveTask() {
                try {
                    const formData = this.getFormData();
                    const url = this.currentTask ? `/api/tasks/${this.currentTask.id}` : '/api/tasks';
                    const method = this.currentTask ? 'PUT' : 'POST';

                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    this.closeTaskModal();
                    await this.loadTasks();
                    await this.loadStats();
                } catch (error) {
                    console.error('Failed to save task:', error);
                    this.showError('Failed to save task');
                }
            },

            getFormData() {
                const tags = document.getElementById('taskTags').value
                    .split(',')
                    .map(tag => tag.trim())
                    .filter(tag => tag.length > 0);

                return {
                    title: document.getElementById('taskTitle').value,
                    description: document.getElementById('taskDescription').value,
                    priority: document.getElementById('taskPriority').value,
                    status: document.getElementById('taskStatus').value,
                    category: document.getElementById('taskCategory').value,
                    type: document.getElementById('taskType').value,
                    dueDate: document.getElementById('taskDueDate').value || null,
                    estimatedHours: parseFloat(document.getElementById('taskEstimatedHours').value) || 0,
                    tags: tags
                };
            },

            openTaskModal(taskId = null) {
                this.currentTask = taskId ? this.tasks.find(t => t.id === taskId) : null;

                if (this.currentTask) {
                    this.populateTaskForm(this.currentTask);
                    document.getElementById('modalTitle').textContent = 'Edit Task';
                } else {
                    this.clearTaskForm();
                    document.getElementById('modalTitle').textContent = 'New Task';
                }

                document.getElementById('taskModal').classList.add('active');
            },

            closeTaskModal() {
                document.getElementById('taskModal').classList.remove('active');
                this.currentTask = null;
            },

            populateTaskForm(task) {
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description;
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskStatus').value = task.status;
                document.getElementById('taskCategory').value = task.category;
                document.getElementById('taskType').value = task.type;
                document.getElementById('taskEstimatedHours').value = task.estimatedHours;
                document.getElementById('taskTags').value = task.tags.join(', ');

                if (task.dueDate) {
                    const date = new Date(task.dueDate);
                    const localISOTime = new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
                    document.getElementById('taskDueDate').value = localISOTime;
                }
            },

            clearTaskForm() {
                document.getElementById('taskForm').reset();
                document.getElementById('taskPriority').value = 'medium';
                document.getElementById('taskStatus').value = 'todo';
                document.getElementById('taskCategory').value = 'admin';
                document.getElementById('taskType').value = 'general';
            },

            // Utility functions
            formatPriority(priority) {
                const priorityMap = {
                    urgent: 'Urgent',
                    high: 'High',
                    medium: 'Medium',
                    low: 'Low'
                };
                return priorityMap[priority] || priority;
            },

            formatStatus(status) {
                const statusMap = {
                    todo: 'To Do',
                    in_progress: 'In Progress',
                    review: 'Review',
                    blocked: 'Blocked',
                    completed: 'Completed',
                    cancelled: 'Cancelled'
                };
                return statusMap[status] || status;
            },

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
            },

            isOverdue(dateString) {
                return new Date(dateString) < new Date();
            },

            showError(message) {
                // Simple error display - in a full app, this would be more sophisticated
                console.error(message);
                alert(message);
            }
        };

        // Global functions for UI interactions
        async function openTaskModal(taskId = null) {
            TasksApp.openTaskModal(taskId);
        }

        function closeTaskModal() {
            TasksApp.closeTaskModal();
        }

        async function saveTask() {
            await TasksApp.saveTask();
        }

        async function toggleTaskStatus(taskId) {
            const task = TasksApp.tasks.find(t => t.id === taskId);
            const newStatus = task.status === 'completed' ? 'todo' : 'completed';
            await TasksApp.updateTaskStatus(taskId, newStatus);
        }

        async function editTask(taskId) {
            event.stopPropagation();
            TasksApp.openTaskModal(taskId);
        }

        async function deleteTask(taskId) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this task?')) {
                try {
                    const response = await fetch(`/api/tasks/${taskId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    await TasksApp.loadTasks();
                    await TasksApp.loadStats();
                } catch (error) {
                    console.error('Failed to delete task:', error);
                    TasksApp.showError('Failed to delete task');
                }
            }
        }

        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('searchInput').value = '';

            TasksApp.filters = { status: '', priority: '', category: '', search: '' };
            TasksApp.applyFilters();
        }

        async function refreshTasks() {
            await TasksApp.loadTasks();
            await TasksApp.loadStats();
        }

        async function showMyTasks() {
            const response = await fetch('/api/tasks/my', {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                }
            });

            if (response.ok) {
                const result = await response.json();
                TasksApp.tasks = result.data;
                TasksApp.filteredTasks = [...TasksApp.tasks];
                TasksApp.renderCurrentView();
            }
        }

        function previousMonth() {
            TasksApp.currentDate.setMonth(TasksApp.currentDate.getMonth() - 1);
            TasksApp.renderCalendarView();
        }

        function nextMonth() {
            TasksApp.currentDate.setMonth(TasksApp.currentDate.getMonth() + 1);
            TasksApp.renderCalendarView();
        }

        function goToToday() {
            TasksApp.currentDate = new Date();
            TasksApp.renderCalendarView();
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            TasksApp.init();
        });
    </script>
</body>
</html>