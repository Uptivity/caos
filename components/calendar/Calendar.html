<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - CAOS CRM</title>
    <link rel="stylesheet" href="../../styles/snowui.css">
    <style>
        /* Calendar-specific styles */
        .calendar-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-6);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            flex-wrap: wrap;
            gap: var(--space-4);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .calendar-title {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            margin: 0;
        }

        .calendar-actions {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .view-selector {
            display: flex;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .view-btn {
            padding: var(--space-2) var(--space-3);
            border: none;
            background: var(--bg-white);
            cursor: pointer;
            transition: all 0.2s;
            border-right: 1px solid var(--border-color);
        }

        .view-btn:last-child {
            border-right: none;
        }

        .view-btn.active {
            background: var(--primary-500);
            color: white;
        }

        .view-btn:hover:not(.active) {
            background: var(--gray-50);
        }

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        /* Month View */
        .month-view {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .month-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--gray-50);
            border-bottom: 1px solid var(--border-color);
        }

        .month-header div {
            padding: var(--space-3);
            text-align: center;
            font-weight: var(--font-semibold);
            color: var(--text-600);
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 120px;
            border-right: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            padding: var(--space-2);
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calendar-day:hover {
            background: var(--gray-25);
        }

        .calendar-day.other-month {
            background: var(--gray-50);
            color: var(--text-400);
        }

        .calendar-day.today {
            background: var(--primary-50);
        }

        .day-number {
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-1);
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .event-item {
            background: var(--primary-100);
            color: var(--primary-800);
            padding: var(--space-1);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid var(--primary-500);
        }

        .event-item:hover {
            background: var(--primary-200);
            transform: translateY(-1px);
        }

        .event-item.meeting {
            background: var(--blue-100);
            color: var(--blue-800);
            border-left-color: var(--blue-500);
        }

        .event-item.call {
            background: var(--green-100);
            color: var(--green-800);
            border-left-color: var(--green-500);
        }

        .event-item.task {
            background: var(--orange-100);
            color: var(--orange-800);
            border-left-color: var(--orange-500);
        }

        .event-item.appointment {
            background: var(--purple-100);
            color: var(--purple-800);
            border-left-color: var(--purple-500);
        }

        /* Week View */
        .week-view {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .week-header {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            background: var(--gray-50);
            border-bottom: 1px solid var(--border-color);
        }

        .week-header div {
            padding: var(--space-3);
            text-align: center;
            font-weight: var(--font-semibold);
            border-right: 1px solid var(--border-light);
        }

        .week-grid {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            max-height: 600px;
            overflow-y: auto;
        }

        .time-slot {
            border-right: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            padding: var(--space-2);
            font-size: var(--text-xs);
            color: var(--text-500);
            text-align: center;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .week-day-column {
            border-right: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            height: 60px;
            position: relative;
            cursor: pointer;
        }

        .week-day-column:hover {
            background: var(--gray-25);
        }

        /* List View */
        .list-view {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .event-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .event-list-item {
            display: flex;
            align-items: center;
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .event-list-item:hover {
            background: var(--gray-25);
        }

        .event-list-item:last-child {
            border-bottom: none;
        }

        .event-time-indicator {
            width: 4px;
            height: 40px;
            border-radius: var(--radius-sm);
            margin-right: var(--space-3);
            flex-shrink: 0;
        }

        .event-details {
            flex: 1;
            min-width: 0;
        }

        .event-title {
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-1);
        }

        .event-meta {
            color: var(--text-500);
            font-size: var(--text-sm);
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        /* Sidebar */
        .calendar-sidebar {
            width: 300px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--space-6);
            position: sticky;
            top: var(--space-6);
        }

        .sidebar-section {
            margin-bottom: var(--space-6);
        }

        .sidebar-section:last-child {
            margin-bottom: 0;
        }

        .sidebar-title {
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-3);
            color: var(--text-700);
        }

        .mini-calendar {
            width: 100%;
        }

        .mini-calendar table {
            width: 100%;
            border-collapse: collapse;
        }

        .mini-calendar th,
        .mini-calendar td {
            text-align: center;
            padding: var(--space-1);
            border: none;
        }

        .mini-calendar th {
            font-weight: var(--font-semibold);
            color: var(--text-600);
            font-size: var(--text-xs);
        }

        .mini-calendar td {
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: background-color 0.2s;
            font-size: var(--text-sm);
        }

        .mini-calendar td:hover {
            background: var(--gray-100);
        }

        .mini-calendar td.today {
            background: var(--primary-500);
            color: white;
        }

        .mini-calendar td.other-month {
            color: var(--text-400);
        }

        .upcoming-events {
            max-height: 300px;
            overflow-y: auto;
        }

        .upcoming-event {
            padding: var(--space-2);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
            border-left: 3px solid var(--primary-500);
            background: var(--gray-50);
            cursor: pointer;
            transition: all 0.2s;
        }

        .upcoming-event:hover {
            background: var(--gray-100);
            transform: translateX(2px);
        }

        .upcoming-event-title {
            font-weight: var(--font-medium);
            margin-bottom: var(--space-1);
            font-size: var(--text-sm);
        }

        .upcoming-event-time {
            color: var(--text-500);
            font-size: var(--text-xs);
        }

        /* Calendar filter */
        .calendar-filter {
            margin-bottom: var(--space-4);
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .filter-chip {
            padding: var(--space-1) var(--space-2);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-chip.active {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
        }

        .filter-chip:hover:not(.active) {
            background: var(--gray-100);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        .modal {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--text-xl);
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background: var(--gray-100);
        }

        .modal-body {
            padding: var(--space-6);
        }

        .modal-footer {
            padding: var(--space-6);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-3);
        }

        /* Form styles */
        .form-row {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .form-row .form-group {
            flex: 1;
        }

        .datetime-inputs {
            display: flex;
            gap: var(--space-2);
            align-items: center;
        }

        .datetime-inputs input {
            flex: 1;
        }

        .color-picker {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-2);
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover,
        .color-option.selected {
            border-color: var(--text-900);
            transform: scale(1.1);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .calendar-container {
                padding: var(--space-4);
            }

            .calendar-header {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-3);
            }

            .calendar-nav {
                justify-content: center;
            }

            .calendar-actions {
                justify-content: center;
            }

            .calendar-grid {
                grid-template-columns: 1fr;
            }

            .calendar-sidebar {
                width: 100%;
                position: static;
                margin-top: var(--space-6);
            }

            .calendar-day {
                min-height: 80px;
            }

            .form-row {
                flex-direction: column;
            }

            .datetime-inputs {
                flex-direction: column;
            }

            .view-selector {
                width: 100%;
            }

            .view-btn {
                flex: 1;
                text-align: center;
            }
        }

        /* Loading and empty states */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .empty-state {
            text-align: center;
            padding: var(--space-12);
            color: var(--text-500);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: var(--space-4);
            color: var(--text-400);
        }

        /* Hide classes for responsive design */
        .hidden {
            display: none !important;
        }

        @media (min-width: 768px) {
            .desktop-hidden {
                display: none !important;
            }
        }

        @media (max-width: 767px) {
            .mobile-hidden {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <!-- Header -->
        <div class="calendar-header">
            <div class="calendar-nav">
                <button class="btn btn-secondary" id="prevBtn">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11 2L5 8l6 6"/>
                    </svg>
                </button>
                <h1 class="calendar-title" id="calendarTitle">Loading...</h1>
                <button class="btn btn-secondary" id="nextBtn">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5 2l6 6-6 6"/>
                    </svg>
                </button>
            </div>

            <div class="calendar-actions">
                <div class="view-selector">
                    <button class="view-btn active" data-view="month">Month</button>
                    <button class="view-btn" data-view="week">Week</button>
                    <button class="view-btn" data-view="list">List</button>
                </div>

                <button class="btn btn-secondary" id="todayBtn">Today</button>
                <button class="btn btn-primary" id="newEventBtn">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: var(--space-1)">
                        <path d="M8 2v6h6v2H8v6H6V10H0V8h6V2h2z"/>
                    </svg>
                    New Event
                </button>
            </div>
        </div>

        <!-- Filter -->
        <div class="calendar-filter">
            <div class="filter-group">
                <div class="filter-chip active" data-type="all">All Events</div>
                <div class="filter-chip" data-type="meeting">Meetings</div>
                <div class="filter-chip" data-type="call">Calls</div>
                <div class="filter-chip" data-type="task">Tasks</div>
                <div class="filter-chip" data-type="appointment">Appointments</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="calendar-grid" style="grid-template-columns: 1fr 300px;">
            <!-- Calendar Views -->
            <div class="calendar-views">
                <!-- Month View -->
                <div class="month-view" id="monthView">
                    <div class="month-header">
                        <div>Sun</div>
                        <div>Mon</div>
                        <div>Tue</div>
                        <div>Wed</div>
                        <div>Thu</div>
                        <div>Fri</div>
                        <div>Sat</div>
                    </div>
                    <div class="month-grid" id="monthGrid">
                        <!-- Calendar days will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Week View -->
                <div class="week-view hidden" id="weekView">
                    <div class="week-header">
                        <div></div>
                        <div id="weekDay0">Sun</div>
                        <div id="weekDay1">Mon</div>
                        <div id="weekDay2">Tue</div>
                        <div id="weekDay3">Wed</div>
                        <div id="weekDay4">Thu</div>
                        <div id="weekDay5">Fri</div>
                        <div id="weekDay6">Sat</div>
                    </div>
                    <div class="week-grid" id="weekGrid">
                        <!-- Week grid will be generated by JavaScript -->
                    </div>
                </div>

                <!-- List View -->
                <div class="list-view hidden" id="listView">
                    <div class="event-list" id="eventList">
                        <!-- Event list will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="calendar-sidebar mobile-hidden">
                <!-- Mini Calendar -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Calendar</div>
                    <div class="mini-calendar">
                        <table id="miniCalendar">
                            <!-- Mini calendar will be generated by JavaScript -->
                        </table>
                    </div>
                </div>

                <!-- Upcoming Events -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Upcoming Events</div>
                    <div class="upcoming-events" id="upcomingEvents">
                        <!-- Upcoming events will be loaded here -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Quick Actions</div>
                    <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                        <button class="btn btn-secondary btn-small" id="quickMeetingBtn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: var(--space-1)">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                            </svg>
                            Quick Meeting
                        </button>
                        <button class="btn btn-secondary btn-small" id="quickCallBtn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: var(--space-1)">
                                <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122L9.98 10.73a6.116 6.116 0 0 1-3.723-3.723L6.55 5.2a.678.678 0 0 0-.122-.58L4.634 2.313z"/>
                            </svg>
                            Quick Call
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal-overlay hidden" id="eventModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="eventModalTitle">New Event</h2>
                <button class="modal-close" id="closeEventModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="eventForm">
                    <div class="form-group">
                        <label for="eventTitle">Event Title *</label>
                        <input type="text" id="eventTitle" name="title" required>
                    </div>

                    <div class="form-group">
                        <label for="eventDescription">Description</label>
                        <textarea id="eventDescription" name="description" rows="3"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventType">Event Type</label>
                            <select id="eventType" name="type">
                                <option value="meeting">Meeting</option>
                                <option value="call">Call</option>
                                <option value="task">Task</option>
                                <option value="appointment">Appointment</option>
                                <option value="reminder">Reminder</option>
                                <option value="personal">Personal</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="eventPriority">Priority</label>
                            <select id="eventPriority" name="priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="allDayEvent" name="allDay">
                            All Day Event
                        </label>
                    </div>

                    <div class="form-row" id="timeInputs">
                        <div class="form-group">
                            <label for="startDateTime">Start</label>
                            <div class="datetime-inputs">
                                <input type="date" id="startDate" name="startDate" required>
                                <input type="time" id="startTime" name="startTime" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="endDateTime">End</label>
                            <div class="datetime-inputs">
                                <input type="date" id="endDate" name="endDate" required>
                                <input type="time" id="endTime" name="endTime" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="eventLocation">Location</label>
                        <input type="text" id="eventLocation" name="location" placeholder="Meeting room, address, or online">
                    </div>

                    <div class="form-group">
                        <label for="meetingUrl">Meeting URL</label>
                        <input type="url" id="meetingUrl" name="meetingUrl" placeholder="https://zoom.us/j/...">
                    </div>

                    <div class="form-group">
                        <label for="eventAttendees">Attendees</label>
                        <input type="text" id="eventAttendees" name="attendees" placeholder="Enter email addresses separated by commas">
                    </div>

                    <div class="form-group">
                        <label>Event Color</label>
                        <div class="color-picker">
                            <div class="color-option selected" data-color="#007bff" style="background: #007bff;"></div>
                            <div class="color-option" data-color="#28a745" style="background: #28a745;"></div>
                            <div class="color-option" data-color="#dc3545" style="background: #dc3545;"></div>
                            <div class="color-option" data-color="#fd7e14" style="background: #fd7e14;"></div>
                            <div class="color-option" data-color="#6f42c1" style="background: #6f42c1;"></div>
                            <div class="color-option" data-color="#e83e8c" style="background: #e83e8c;"></div>
                        </div>
                        <input type="hidden" id="eventColor" name="color" value="#007bff">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="recurringEvent" name="recurring">
                            Recurring Event
                        </label>
                    </div>

                    <div class="form-group hidden" id="recurrenceOptions">
                        <label for="recurrenceType">Repeat</label>
                        <select id="recurrenceType" name="recurrenceType">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>

                        <div style="margin-top: var(--space-2);">
                            <label for="recurrenceEnd">Until</label>
                            <input type="date" id="recurrenceEnd" name="recurrenceEnd">
                        </div>
                    </div>

                    <input type="hidden" id="eventId" name="id">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelEventBtn">Cancel</button>
                <button type="button" class="btn btn-danger hidden" id="deleteEventBtn">Delete</button>
                <button type="submit" class="btn btn-primary" id="saveEventBtn">Save Event</button>
            </div>
        </div>
    </div>

    <!-- Event View Modal -->
    <div class="modal-overlay hidden" id="eventViewModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="eventViewTitle">Event Details</h2>
                <button class="modal-close" id="closeEventViewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="eventViewContent">
                    <!-- Event details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="editEventBtn">Edit</button>
                <button type="button" class="btn btn-primary" id="closeViewBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="loading-spinner">
            <svg width="40" height="40" viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="18" fill="none" stroke="#007bff" stroke-width="2" stroke-dasharray="28 28" stroke-dashoffset="28">
                    <animateTransform attributeName="transform" type="rotate" values="0 20 20;360 20 20" dur="1s" repeatCount="indefinite"/>
                </circle>
            </svg>
        </div>
    </div>

    <script>
        // Calendar Application
        class CalendarApp {
            constructor() {
                this.currentDate = new Date();
                this.currentView = 'month';
                this.events = [];
                this.selectedEvent = null;
                this.apiBase = window.location.origin.replace('3000', '3001') + '/api/calendar';
                this.token = localStorage.getItem('token');

                this.init();
            }

            async init() {
                this.bindEvents();
                this.updateCalendarTitle();
                await this.loadEvents();
                this.renderCurrentView();
                this.generateMiniCalendar();
                this.loadUpcomingEvents();
            }

            bindEvents() {
                // Navigation
                document.getElementById('prevBtn').addEventListener('click', () => this.navigate(-1));
                document.getElementById('nextBtn').addEventListener('click', () => this.navigate(1));
                document.getElementById('todayBtn').addEventListener('click', () => this.goToToday());

                // View switching
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchView(e.target.dataset.view));
                });

                // Filter buttons
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.addEventListener('click', (e) => this.filterEvents(e.target.dataset.type));
                });

                // Modal handling
                document.getElementById('newEventBtn').addEventListener('click', () => this.openEventModal());
                document.getElementById('closeEventModal').addEventListener('click', () => this.closeEventModal());
                document.getElementById('cancelEventBtn').addEventListener('click', () => this.closeEventModal());
                document.getElementById('saveEventBtn').addEventListener('click', () => this.saveEvent());
                document.getElementById('deleteEventBtn').addEventListener('click', () => this.deleteEvent());

                // Event view modal
                document.getElementById('closeEventViewModal').addEventListener('click', () => this.closeEventViewModal());
                document.getElementById('closeViewBtn').addEventListener('click', () => this.closeEventViewModal());
                document.getElementById('editEventBtn').addEventListener('click', () => this.editCurrentEvent());

                // Form handling
                document.getElementById('allDayEvent').addEventListener('change', (e) => {
                    document.getElementById('timeInputs').style.display = e.target.checked ? 'none' : 'flex';
                });

                document.getElementById('recurringEvent').addEventListener('change', (e) => {
                    document.getElementById('recurrenceOptions').classList.toggle('hidden', !e.target.checked);
                });

                // Color picker
                document.querySelectorAll('.color-option').forEach(option => {
                    option.addEventListener('click', (e) => this.selectColor(e.target));
                });

                // Quick actions
                document.getElementById('quickMeetingBtn').addEventListener('click', () => this.quickEvent('meeting'));
                document.getElementById('quickCallBtn').addEventListener('click', () => this.quickEvent('call'));

                // Modal overlay click to close
                document.getElementById('eventModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) this.closeEventModal();
                });

                document.getElementById('eventViewModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) this.closeEventViewModal();
                });
            }

            // API Methods
            async makeRequest(endpoint, options = {}) {
                try {
                    const response = await fetch(`${this.apiBase}${endpoint}`, {
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.token}`,
                            ...options.headers
                        },
                        ...options
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    return await response.json();
                } catch (error) {
                    console.error('API request failed:', error);
                    this.showNotification('API request failed: ' + error.message, 'error');
                    throw error;
                }
            }

            async loadEvents() {
                try {
                    this.showLoading(true);
                    const startDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                    const endDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);

                    const response = await this.makeRequest(`/events?startDate=${startDate.toISOString()}&endDate=${endDate.toISOString()}`);

                    if (response.success) {
                        this.events = response.data.map(event => ({
                            ...event,
                            startTime: event.startTime ? new Date(event.startTime) : null,
                            endTime: event.endTime ? new Date(event.endTime) : null
                        }));
                        this.renderCurrentView();
                    }
                } catch (error) {
                    console.error('Failed to load events:', error);
                } finally {
                    this.showLoading(false);
                }
            }

            async saveEvent() {
                try {
                    const formData = new FormData(document.getElementById('eventForm'));
                    const eventData = Object.fromEntries(formData.entries());

                    // Process form data
                    if (eventData.allDay) {
                        eventData.startTime = null;
                        eventData.endTime = null;
                    } else {
                        eventData.startTime = new Date(`${eventData.startDate}T${eventData.startTime}`);
                        eventData.endTime = new Date(`${eventData.endDate}T${eventData.endTime}`);
                    }

                    // Handle attendees
                    if (eventData.attendees) {
                        eventData.attendees = eventData.attendees.split(',').map(email => email.trim()).filter(email => email);
                    } else {
                        eventData.attendees = [];
                    }

                    // Handle recurring
                    if (eventData.recurring) {
                        eventData.recurrencePattern = {
                            type: eventData.recurrenceType,
                            interval: 1
                        };
                    }

                    // Clean up form-specific fields
                    delete eventData.startDate;
                    delete eventData.endDate;
                    delete eventData.recurrenceType;

                    const isEdit = eventData.id;
                    const endpoint = isEdit ? `/events/${eventData.id}` : '/events';
                    const method = isEdit ? 'PUT' : 'POST';

                    const response = await this.makeRequest(endpoint, {
                        method: method,
                        body: JSON.stringify(eventData)
                    });

                    if (response.success) {
                        this.showNotification(`Event ${isEdit ? 'updated' : 'created'} successfully!`, 'success');
                        this.closeEventModal();
                        await this.loadEvents();
                        this.loadUpcomingEvents();
                    }
                } catch (error) {
                    console.error('Failed to save event:', error);
                }
            }

            async deleteEvent() {
                if (!this.selectedEvent) return;

                if (confirm('Are you sure you want to delete this event?')) {
                    try {
                        const response = await this.makeRequest(`/events/${this.selectedEvent.id}`, {
                            method: 'DELETE'
                        });

                        if (response.success) {
                            this.showNotification('Event deleted successfully!', 'success');
                            this.closeEventModal();
                            await this.loadEvents();
                            this.loadUpcomingEvents();
                        }
                    } catch (error) {
                        console.error('Failed to delete event:', error);
                    }
                }
            }

            async loadUpcomingEvents() {
                try {
                    const response = await this.makeRequest('/events/upcoming?days=7');

                    if (response.success) {
                        this.renderUpcomingEvents(response.data);
                    }
                } catch (error) {
                    console.error('Failed to load upcoming events:', error);
                }
            }

            // Calendar Rendering
            renderCurrentView() {
                // Hide all views
                document.getElementById('monthView').classList.add('hidden');
                document.getElementById('weekView').classList.add('hidden');
                document.getElementById('listView').classList.add('hidden');

                // Show selected view
                switch (this.currentView) {
                    case 'month':
                        this.renderMonthView();
                        document.getElementById('monthView').classList.remove('hidden');
                        break;
                    case 'week':
                        this.renderWeekView();
                        document.getElementById('weekView').classList.remove('hidden');
                        break;
                    case 'list':
                        this.renderListView();
                        document.getElementById('listView').classList.remove('hidden');
                        break;
                }
            }

            renderMonthView() {
                const monthGrid = document.getElementById('monthGrid');
                const startDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                const endDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);

                // Calculate first day of week for the month
                const firstDayOfWeek = startDate.getDay();
                const daysInMonth = endDate.getDate();

                // Clear existing content
                monthGrid.innerHTML = '';

                // Add empty cells for days before the first day of the month
                for (let i = 0; i < firstDayOfWeek; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day other-month';
                    monthGrid.appendChild(emptyDay);
                }

                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    const dayDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), day);
                    const isToday = this.isSameDay(dayDate, new Date());

                    dayElement.className = `calendar-day ${isToday ? 'today' : ''}`;
                    dayElement.innerHTML = `
                        <div class="day-number">${day}</div>
                        <div class="day-events" id="day-events-${day}"></div>
                    `;

                    // Add click handler
                    dayElement.addEventListener('click', () => this.dayClicked(dayDate));

                    monthGrid.appendChild(dayElement);

                    // Add events for this day
                    this.renderDayEvents(day, dayDate);
                }
            }

            renderDayEvents(day, date) {
                const dayEvents = this.events.filter(event => {
                    if (!event.startTime) return false;
                    return this.isSameDay(event.startTime, date);
                });

                const container = document.getElementById(`day-events-${day}`);
                if (!container) return;

                container.innerHTML = '';

                dayEvents.slice(0, 3).forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = `event-item ${event.type}`;
                    eventElement.style.borderLeftColor = event.color || '#007bff';
                    eventElement.textContent = event.title;
                    eventElement.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.viewEvent(event);
                    });
                    container.appendChild(eventElement);
                });

                // Show "more" indicator if there are more events
                if (dayEvents.length > 3) {
                    const moreElement = document.createElement('div');
                    moreElement.className = 'event-item';
                    moreElement.textContent = `+${dayEvents.length - 3} more`;
                    moreElement.style.background = 'var(--gray-100)';
                    moreElement.style.color = 'var(--text-600)';
                    container.appendChild(moreElement);
                }
            }

            renderWeekView() {
                const weekGrid = document.getElementById('weekGrid');
                const startOfWeek = this.getStartOfWeek(this.currentDate);

                weekGrid.innerHTML = '';

                // Generate time slots (9 AM to 6 PM)
                for (let hour = 9; hour <= 18; hour++) {
                    // Time label
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = hour === 12 ? '12 PM' : hour > 12 ? `${hour - 12} PM` : `${hour} AM`;
                    weekGrid.appendChild(timeSlot);

                    // Day columns
                    for (let day = 0; day < 7; day++) {
                        const dayColumn = document.createElement('div');
                        dayColumn.className = 'week-day-column';

                        const slotDate = new Date(startOfWeek);
                        slotDate.setDate(startOfWeek.getDate() + day);
                        slotDate.setHours(hour);

                        dayColumn.addEventListener('click', () => this.createEventAtTime(slotDate));
                        weekGrid.appendChild(dayColumn);
                    }
                }

                // Update week header
                for (let day = 0; day < 7; day++) {
                    const headerDate = new Date(startOfWeek);
                    headerDate.setDate(startOfWeek.getDate() + day);

                    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    document.getElementById(`weekDay${day}`).textContent =
                        `${dayNames[day]} ${headerDate.getDate()}`;
                }
            }

            renderListView() {
                const eventList = document.getElementById('eventList');
                const sortedEvents = [...this.events].sort((a, b) => {
                    if (!a.startTime && !b.startTime) return 0;
                    if (!a.startTime) return 1;
                    if (!b.startTime) return -1;
                    return a.startTime - b.startTime;
                });

                eventList.innerHTML = '';

                if (sortedEvents.length === 0) {
                    eventList.innerHTML = `
                        <div class="empty-state">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zM4 8h12v8H4V8z"/>
                            </svg>
                            <p>No events found for the selected period.</p>
                            <button class="btn btn-primary" onclick="calendarApp.openEventModal()">Create your first event</button>
                        </div>
                    `;
                    return;
                }

                sortedEvents.forEach(event => {
                    const listItem = document.createElement('div');
                    listItem.className = 'event-list-item';

                    const timeIndicator = document.createElement('div');
                    timeIndicator.className = 'event-time-indicator';
                    timeIndicator.style.backgroundColor = event.color || '#007bff';

                    const eventDetails = document.createElement('div');
                    eventDetails.className = 'event-details';

                    const eventTitle = document.createElement('div');
                    eventTitle.className = 'event-title';
                    eventTitle.textContent = event.title;

                    const eventMeta = document.createElement('div');
                    eventMeta.className = 'event-meta';

                    const timeStr = event.allDay ? 'All Day' :
                        event.startTime ? `${this.formatTime(event.startTime)}${event.endTime ? ' - ' + this.formatTime(event.endTime) : ''}` : 'No time set';

                    eventMeta.innerHTML = `
                        <span>${timeStr}</span>
                        <span>${this.capitalizeFirst(event.type)}</span>
                        ${event.location ? `<span>${event.location}</span>` : ''}
                    `;

                    eventDetails.appendChild(eventTitle);
                    eventDetails.appendChild(eventMeta);

                    listItem.appendChild(timeIndicator);
                    listItem.appendChild(eventDetails);

                    listItem.addEventListener('click', () => this.viewEvent(event));
                    eventList.appendChild(listItem);
                });
            }

            renderUpcomingEvents(events) {
                const container = document.getElementById('upcomingEvents');
                container.innerHTML = '';

                if (events.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-500); text-align: center;">No upcoming events</p>';
                    return;
                }

                events.slice(0, 5).forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'upcoming-event';
                    eventElement.style.borderLeftColor = event.color || '#007bff';

                    const title = document.createElement('div');
                    title.className = 'upcoming-event-title';
                    title.textContent = event.title;

                    const time = document.createElement('div');
                    time.className = 'upcoming-event-time';

                    if (event.startTime) {
                        const eventDate = new Date(event.startTime);
                        const isToday = this.isSameDay(eventDate, new Date());
                        const dateStr = isToday ? 'Today' : this.formatDate(eventDate);
                        const timeStr = event.allDay ? 'All Day' : this.formatTime(eventDate);
                        time.textContent = `${dateStr} at ${timeStr}`;
                    } else {
                        time.textContent = 'No time set';
                    }

                    eventElement.appendChild(title);
                    eventElement.appendChild(time);

                    eventElement.addEventListener('click', () => this.viewEvent(event));
                    container.appendChild(eventElement);
                });
            }

            generateMiniCalendar() {
                const miniCalendar = document.getElementById('miniCalendar');
                const today = new Date();
                const currentMonth = this.currentDate.getMonth();
                const currentYear = this.currentDate.getFullYear();

                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                let html = '<thead><tr>';
                const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                dayNames.forEach(day => html += `<th>${day}</th>`);
                html += '</tr></thead><tbody>';

                let currentDate = new Date(startDate);

                for (let week = 0; week < 6; week++) {
                    html += '<tr>';
                    for (let day = 0; day < 7; day++) {
                        const isCurrentMonth = currentDate.getMonth() === currentMonth;
                        const isToday = this.isSameDay(currentDate, today);
                        const classes = [];

                        if (!isCurrentMonth) classes.push('other-month');
                        if (isToday) classes.push('today');

                        html += `<td class="${classes.join(' ')}" data-date="${currentDate.toISOString()}">${currentDate.getDate()}</td>`;
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    html += '</tr>';
                }

                html += '</tbody>';
                miniCalendar.innerHTML = html;

                // Add click handlers
                miniCalendar.querySelectorAll('td[data-date]').forEach(td => {
                    td.addEventListener('click', (e) => {
                        const clickedDate = new Date(e.target.dataset.date);
                        this.currentDate = clickedDate;
                        this.updateCalendarTitle();
                        this.loadEvents();
                        this.generateMiniCalendar();
                    });
                });
            }

            // Navigation Methods
            navigate(direction) {
                switch (this.currentView) {
                    case 'month':
                        this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                        break;
                    case 'week':
                        this.currentDate.setDate(this.currentDate.getDate() + (direction * 7));
                        break;
                    case 'list':
                        this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                        break;
                }

                this.updateCalendarTitle();
                this.loadEvents();
                this.generateMiniCalendar();
            }

            goToToday() {
                this.currentDate = new Date();
                this.updateCalendarTitle();
                this.loadEvents();
                this.generateMiniCalendar();
            }

            switchView(view) {
                // Update button states
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === view);
                });

                this.currentView = view;
                this.updateCalendarTitle();
                this.renderCurrentView();
            }

            updateCalendarTitle() {
                const title = document.getElementById('calendarTitle');
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                 'July', 'August', 'September', 'October', 'November', 'December'];

                switch (this.currentView) {
                    case 'month':
                        title.textContent = `${monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
                        break;
                    case 'week':
                        const startOfWeek = this.getStartOfWeek(this.currentDate);
                        const endOfWeek = new Date(startOfWeek);
                        endOfWeek.setDate(startOfWeek.getDate() + 6);
                        title.textContent = `${this.formatDate(startOfWeek)} - ${this.formatDate(endOfWeek)}`;
                        break;
                    case 'list':
                        title.textContent = `${monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()} Events`;
                        break;
                }
            }

            // Event Handlers
            dayClicked(date) {
                this.createEventAtTime(date);
            }

            createEventAtTime(date) {
                this.openEventModal();

                // Set default date and time
                const dateStr = date.toISOString().split('T')[0];
                const timeStr = date.toTimeString().substr(0, 5);

                document.getElementById('startDate').value = dateStr;
                document.getElementById('startTime').value = timeStr;

                const endTime = new Date(date);
                endTime.setHours(endTime.getHours() + 1);
                document.getElementById('endDate').value = dateStr;
                document.getElementById('endTime').value = endTime.toTimeString().substr(0, 5);
            }

            viewEvent(event) {
                this.selectedEvent = event;

                // Populate event view modal
                const content = document.getElementById('eventViewContent');
                content.innerHTML = `
                    <div style="margin-bottom: var(--space-4);">
                        <h3 style="margin-bottom: var(--space-2); color: ${event.color || '#007bff'};">${event.title}</h3>
                        ${event.description ? `<p style="color: var(--text-600);">${event.description}</p>` : ''}
                    </div>

                    <div class="event-details-grid" style="display: grid; gap: var(--space-3);">
                        <div><strong>Type:</strong> ${this.capitalizeFirst(event.type)}</div>
                        <div><strong>Priority:</strong> ${this.capitalizeFirst(event.priority)}</div>

                        ${event.startTime ? `
                            <div><strong>Start:</strong> ${this.formatDateTime(event.startTime)}</div>
                            ${event.endTime ? `<div><strong>End:</strong> ${this.formatDateTime(event.endTime)}</div>` : ''}
                        ` : '<div><strong>Time:</strong> All Day</div>'}

                        ${event.location ? `<div><strong>Location:</strong> ${event.location}</div>` : ''}
                        ${event.meetingUrl ? `<div><strong>Meeting URL:</strong> <a href="${event.meetingUrl}" target="_blank">${event.meetingUrl}</a></div>` : ''}
                        ${event.attendees && event.attendees.length ? `<div><strong>Attendees:</strong> ${event.attendees.join(', ')}</div>` : ''}
                    </div>
                `;

                document.getElementById('eventViewModal').classList.remove('hidden');
            }

            editCurrentEvent() {
                if (!this.selectedEvent) return;

                this.closeEventViewModal();
                this.openEventModal(this.selectedEvent);
            }

            filterEvents(type) {
                // Update active filter
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.toggle('active', chip.dataset.type === type);
                });

                // Filter events display
                if (type === 'all') {
                    // Show all events - reload from server
                    this.loadEvents();
                } else {
                    // Filter current events
                    this.events = this.events.filter(event => event.type === type);
                    this.renderCurrentView();
                }
            }

            quickEvent(type) {
                this.openEventModal();
                document.getElementById('eventType').value = type;

                // Set default time to next hour
                const now = new Date();
                const nextHour = new Date(now);
                nextHour.setHours(nextHour.getHours() + 1, 0, 0, 0);

                const dateStr = now.toISOString().split('T')[0];
                const timeStr = nextHour.toTimeString().substr(0, 5);

                document.getElementById('startDate').value = dateStr;
                document.getElementById('startTime').value = timeStr;

                const endTime = new Date(nextHour);
                endTime.setHours(endTime.getHours() + 1);
                document.getElementById('endDate').value = dateStr;
                document.getElementById('endTime').value = endTime.toTimeString().substr(0, 5);

                // Set default title
                document.getElementById('eventTitle').value = type === 'meeting' ? 'Team Meeting' : 'Phone Call';
                document.getElementById('eventTitle').select();
            }

            // Modal Methods
            openEventModal(event = null) {
                const modal = document.getElementById('eventModal');
                const form = document.getElementById('eventForm');
                const title = document.getElementById('eventModalTitle');
                const deleteBtn = document.getElementById('deleteEventBtn');

                form.reset();
                this.selectedEvent = event;

                if (event) {
                    // Edit mode
                    title.textContent = 'Edit Event';
                    deleteBtn.classList.remove('hidden');
                    this.populateEventForm(event);
                } else {
                    // Create mode
                    title.textContent = 'New Event';
                    deleteBtn.classList.add('hidden');
                    // Set default date to today
                    const today = new Date();
                    document.getElementById('startDate').value = today.toISOString().split('T')[0];
                    document.getElementById('endDate').value = today.toISOString().split('T')[0];
                }

                modal.classList.remove('hidden');
                document.getElementById('eventTitle').focus();
            }

            populateEventForm(event) {
                document.getElementById('eventId').value = event.id;
                document.getElementById('eventTitle').value = event.title;
                document.getElementById('eventDescription').value = event.description || '';
                document.getElementById('eventType').value = event.type;
                document.getElementById('eventPriority').value = event.priority;
                document.getElementById('eventLocation').value = event.location || '';
                document.getElementById('meetingUrl').value = event.meetingUrl || '';
                document.getElementById('eventColor').value = event.color || '#007bff';
                document.getElementById('allDayEvent').checked = event.allDay || false;

                if (event.attendees) {
                    document.getElementById('eventAttendees').value = event.attendees.join(', ');
                }

                if (event.startTime && !event.allDay) {
                    document.getElementById('startDate').value = event.startTime.toISOString().split('T')[0];
                    document.getElementById('startTime').value = event.startTime.toTimeString().substr(0, 5);
                }

                if (event.endTime && !event.allDay) {
                    document.getElementById('endDate').value = event.endTime.toISOString().split('T')[0];
                    document.getElementById('endTime').value = event.endTime.toTimeString().substr(0, 5);
                }

                // Handle recurring events
                if (event.recurring) {
                    document.getElementById('recurringEvent').checked = true;
                    document.getElementById('recurrenceOptions').classList.remove('hidden');
                    if (event.recurrencePattern) {
                        document.getElementById('recurrenceType').value = event.recurrencePattern.type;
                    }
                }

                // Update color selection
                this.selectColorByValue(event.color || '#007bff');

                // Update time inputs visibility
                document.getElementById('timeInputs').style.display = event.allDay ? 'none' : 'flex';
            }

            closeEventModal() {
                document.getElementById('eventModal').classList.add('hidden');
                this.selectedEvent = null;
            }

            closeEventViewModal() {
                document.getElementById('eventViewModal').classList.add('hidden');
                this.selectedEvent = null;
            }

            selectColor(colorElement) {
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                });
                colorElement.classList.add('selected');
                document.getElementById('eventColor').value = colorElement.dataset.color;
            }

            selectColorByValue(color) {
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.toggle('selected', option.dataset.color === color);
                });
            }

            // Utility Methods
            isSameDay(date1, date2) {
                return date1.getDate() === date2.getDate() &&
                       date1.getMonth() === date2.getMonth() &&
                       date1.getFullYear() === date2.getFullYear();
            }

            getStartOfWeek(date) {
                const startOfWeek = new Date(date);
                startOfWeek.setDate(date.getDate() - date.getDay());
                return startOfWeek;
            }

            formatDate(date) {
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric'
                });
            }

            formatTime(date) {
                return date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            }

            formatDateTime(date) {
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            }

            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            showLoading(show) {
                document.getElementById('loadingOverlay').classList.toggle('hidden', !show);
            }

            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 20px;
                    background: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#007bff'};
                    color: white;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                    z-index: 10000;
                    animation: slideIn 0.3s ease-out;
                `;
                notification.textContent = message;

                document.body.appendChild(notification);

                // Remove after 3 seconds
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }

        // Add notification animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }

            .loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(255, 255, 255, 0.8);
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        `;
        document.head.appendChild(style);

        // Initialize Calendar App
        let calendarApp;
        document.addEventListener('DOMContentLoaded', () => {
            calendarApp = new CalendarApp();
        });
    </script>
</body>
</html>